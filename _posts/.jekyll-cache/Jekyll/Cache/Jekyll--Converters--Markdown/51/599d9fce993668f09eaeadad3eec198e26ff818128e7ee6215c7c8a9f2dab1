I"ÑH<h4 id="æ­å»ºzookeeper3412é›†ç¾¤">æ­å»ºzookeeper3.4.12é›†ç¾¤</h4>
<p>ZooKeeper æ˜¯ Apache çš„ä¸€ä¸ªé¡¶çº§é¡¹ç›®ï¼Œä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›é«˜æ•ˆã€é«˜å¯ç”¨çš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œæä¾›äº†è¯¸å¦‚æ•°æ®å‘å¸ƒ/è®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥å’Œåˆ†å¸ƒå¼é”ç­‰åˆ†å¸ƒå¼åŸºç¡€æœåŠ¡ã€‚<br />
ç”±äº ZooKeeper ä¾¿æ·çš„ä½¿ç”¨æ–¹å¼ã€å“è¶Šçš„æ€§èƒ½å’Œè‰¯å¥½çš„ç¨³å®šæ€§ï¼Œè¢«å¹¿æ³›åœ°åº”ç”¨äºè¯¸å¦‚ Hadoopã€HBaseã€Kafka å’Œ Dubbo ç­‰å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚
Zookeeper æœ‰ä¸‰ç§è¿è¡Œæ¨¡å¼ï¼šå•æœºæ¨¡å¼ã€ä¼ªé›†ç¾¤æ¨¡å¼å’Œé›†ç¾¤æ¨¡å¼ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥é›†ç¾¤æ¨¡å¼ä¸ºä¾‹è¿›è¡Œä»‹ç»ã€‚<br />
é›†ç¾¤æ¨¡å¼æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œåªè¦é›†ç¾¤ä¸­å­˜åœ¨è¶…è¿‡ä¸€åŠçš„æœºå™¨èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°±èƒ½å¤Ÿæ­£å¸¸å¯¹å¤–æœåŠ¡ã€‚æ­£æ˜¯åŸºäºè¿™ä¸ªç‰¹æ€§ï¼Œè¦å°† ZK é›†ç¾¤çš„èŠ‚ç‚¹æ•°é‡è¦ä¸ºå¥‡æ•°ï¼ˆ2n+1ï¼šå¦‚ 3ã€5ã€7 ä¸ªèŠ‚ç‚¹ï¼‰è¾ƒä¸ºåˆé€‚ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ä¸»æœºä¿¡æ¯ï¼š
zookeeper1  192.168.95.85
zookeeper2  192.168.95.86
zookeeper3 192.168.95.87
</code></pre></div></div>

<h4 id="å‰ææ¡ä»¶">å‰ææ¡ä»¶</h4>
<ul>
  <li>ç¯å¢ƒå…·å¤‡JAVAç¯å¢ƒ</li>
</ul>

<h4 id="å®‰è£…">å®‰è£…</h4>
<p><strong>1ã€ä¸‹è½½å®˜æ–¹zkå®‰è£…åŒ…å¹¶è§£å‹</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>wget https://archive.apache.org/dist/zookeeper/zookeeper-3.4.12/zookeeper-3.4.12.tar.gz
<span class="nv">$ </span><span class="nb">mkdir</span> /zk
<span class="nv">$ </span><span class="nb">tar </span>xvf zookeeper-3.4.12.tar.gz <span class="nt">-d</span> /zk
</code></pre></div></div>

<p><strong>2ã€åˆ›å»ºzkæ•°æ®ç›®å½•å’Œæ—¥å¿—ç›®å½•</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir</span> /opt/zookeeper/data
<span class="nv">$ </span><span class="nb">mkdir</span> /opt/zookeeper/logs
</code></pre></div></div>

<p><strong>3ã€åˆ›å»ºmyidæ–‡ä»¶</strong><br />
åœ¨å„æœåŠ¡å™¨èŠ‚ç‚¹(zk1ã€zk2ã€zk3)çš„ dataDir ç›®å½•ä¸‹åˆ›å»ºåä¸º myid çš„æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ç¬¬ä¸€è¡Œå†™ä¸Šå¯¹åº”çš„ Server idã€‚è¿™ä¸ªidå¿…é¡»åœ¨é›†ç¾¤ç¯å¢ƒä¸­æœåŠ¡å™¨æ ‡è¯†ä¸­æ˜¯å”¯ä¸€çš„ï¼Œä¸”å¤§å°åœ¨1ï½255ä¹‹é—´ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zk1
<span class="nv">$ </span><span class="nb">cd</span> /opt/zookeeper/data
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"1"</span> <span class="o">&gt;</span> myid
zk2
<span class="nv">$ </span><span class="nb">cd</span> /opt/zookeeper/data
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"2"</span> <span class="o">&gt;</span> myid
zk3
<span class="nv">$ </span><span class="nb">cd</span> /opt/zookeeper/data
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"3"</span> <span class="o">&gt;</span> myid
</code></pre></div></div>

<p><strong>4ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</strong> <br />
å°† zookeeper-3.4.12/conf ç›®å½•ä¸‹çš„ zoo_sample.cfg æ–‡ä»¶æ‹·è´ä¸€ä»½ï¼Œå‘½åä¸º zoo.cfg</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /zk/zookeeper-3.4.12/conf
<span class="nv">$ </span><span class="nb">cp </span>zoo_sample.cfg zoo.cfg
</code></pre></div></div>
<p>ä¿®æ”¹zoo.cfgé…ç½®æ–‡ä»¶ (3å°æœºå™¨éƒ½éœ€è¦ï¼Œå¯ä»¥å…ˆé…ç½®å¥½ä¸€å°ï¼Œç„¶åé€šè¿‡ scp ç­‰å‘½ä»¤å¤åˆ¶åˆ°å…¶å®ƒæœåŠ¡å™¨èŠ‚ç‚¹)</p>
<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tickTime</span>=<span class="m">2000</span>
<span class="n">initLimit</span>=<span class="m">10</span>
<span class="n">syncLimit</span>=<span class="m">5</span>
<span class="n">dataDir</span>=/<span class="n">opt</span>/<span class="n">zookeeper</span>
<span class="n">clientPort</span>=<span class="m">2182</span>
<span class="n">server</span>.<span class="m">1</span> = <span class="m">192</span>.<span class="m">168</span>.<span class="m">95</span>.<span class="m">85</span>:<span class="m">2888</span>:<span class="m">3888</span>
<span class="n">server</span>.<span class="m">2</span> = <span class="m">192</span>.<span class="m">168</span>.<span class="m">95</span>.<span class="m">86</span>:<span class="m">2888</span>:<span class="m">3888</span>
<span class="n">server</span>.<span class="m">3</span> = <span class="m">192</span>.<span class="m">168</span>.<span class="m">95</span>.<span class="m">87</span>:<span class="m">2888</span>:<span class="m">3888</span>
</code></pre></div></div>

<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
  <li>
    <p>tickTime=2000
Zookeeperæœ€å°æ—¶é—´å•å…ƒï¼Œå•ä½ä¸ºmsï¼Œé»˜è®¤å€¼ä¸º3000ã€‚ä¹Ÿå°±æ˜¯Leaderä¸Followeræ¯éš”tickTimeæ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ã€‚</p>
  </li>
  <li>
    <p>initLimit=10
LeaderæœåŠ¡å™¨ç­‰å¾…Followerå¯åŠ¨å¹¶å®Œæˆæ•°æ®åŒæ­¥çš„æ—¶é—´ï¼Œé»˜è®¤å€¼10ã€‚
å½“å·²ç»è¶…è¿‡10*tickTimeåï¼ŒLeaderè¿˜æ²¡æœ‰æ”¶åˆ°Followerçš„è¿”å›ä¿¡æ¯,é‚£ä¹ˆè¡¨æ˜è¿™ä¸ªFollowerè¿æ¥æˆ–åŒæ­¥å¤±è´¥ã€‚</p>
  </li>
  <li>
    <p>syncLimit=5
LeaderæœåŠ¡å™¨å’ŒFollowerä¹‹é—´è¿›è¡Œå¿ƒè·³æ£€æµ‹çš„æœ€å¤§å»¶æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼5ï¼Œæœ€é•¿ä¸èƒ½è¶…è¿‡5*tickTime</p>
  </li>
  <li>
    <p>dataDir=/home/{$user}/zookeeper/zookeeper-3.4.12/data
å­˜æ”¾å†…å­˜æ•°æ®ç»“æ„çš„snapshotï¼Œä¾¿äºå¿«é€Ÿæ¢å¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹åŠ¡æ—¥å¿—ä¹Ÿä¼šå­˜å‚¨åœ¨è¿™é‡Œã€‚å»ºè®®åŒæ—¶é…ç½®å‚æ•°dataLogDir, äº‹åŠ¡æ—¥å¿—çš„å†™æ€§èƒ½ç›´æ¥å½±å“zkæ€§èƒ½ã€‚</p>
  </li>
  <li>
    <p>dataLogDir=/home/{$user}/zookeeper/zookeeper-3.4.12/data
dataLogDiräº‹åŠ¡æ—¥å¿—è¾“å‡ºç›®å½•ã€‚ä¸ºäº†è¾¾åˆ°æ€§èƒ½æœ€å¤§åŒ–ï¼Œä¸€èˆ¬å»ºè®®æŠŠdataDirå’ŒdataLogDiråˆ†åˆ°ä¸åŒçš„ç£ç›˜ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥å……åˆ†åˆ©ç”¨ç£ç›˜é¡ºåºå†™çš„ç‰¹æ€§ã€‚</p>
  </li>
  <li>
    <p>autopurge.purgeInterval, autopurge.snapRetainCount
å®¢æˆ·ç«¯åœ¨ä¸zookeeperäº¤äº’è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿéå¸¸å¤šçš„æ—¥å¿—ï¼Œè€Œä¸”zookeeperä¹Ÿä¼šå°†å†…å­˜ä¸­çš„æ•°æ®ä½œä¸ºsnapshotä¿å­˜ä¸‹æ¥ï¼Œè¿™äº›æ•°æ®æ˜¯ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤çš„ï¼Œè¿™æ ·ç£ç›˜ä¸­è¿™æ ·çš„æ•°æ®å°±ä¼šè¶Šæ¥è¶Šå¤šã€‚ä¸è¿‡å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªå‚æ•°æ¥è®¾ç½®ï¼Œè®©zookeeperè‡ªåŠ¨åˆ é™¤æ•°æ®ã€‚
autopurge.purgeIntervalï¼šæŒ‡å®šè‡ªåŠ¨æ¸…ç†å¿«ç…§æ–‡ä»¶å’Œäº‹åŠ¡æ—¥å¿—æ–‡ä»¶çš„æ—¶é—´ï¼Œå•ä½ä¸ºhï¼Œé»˜è®¤ä¸º0è¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç†ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨è„šæœ¬zkCleanup.shæ‰‹åŠ¨æ¸…ç†ã€‚å¦‚æœä¸æ¸…ç†åˆ™ç£ç›˜ç©ºé—´å ç”¨è¶Šæ¥è¶Šå¤§ã€‚
autopurge.snapRetainCountï¼šç”¨äºæŒ‡å®šä¿ç•™å¿«ç…§æ–‡ä»¶å’Œäº‹åŠ¡æ—¥å¿—æ–‡ä»¶çš„ä¸ªæ•°ï¼Œé»˜è®¤ä¸º3ã€‚
ä¸è¿‡å¦‚æœä½ çš„é›†ç¾¤æ˜¯ä¸€ä¸ªéå¸¸ç¹å¿™çš„é›†ç¾¤ï¼Œç„¶ååˆç¢°ä¸Šè¿™ä¸ªåˆ é™¤æ“ä½œï¼Œå¯èƒ½ä¼šå½±å“zookeeperé›†ç¾¤çš„æ€§èƒ½ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šè®©è¿™ä¸ªè¿‡ç¨‹åœ¨è®¿é—®ä½è°·çš„æ—¶å€™è¿›è¡Œï¼Œä½†æ˜¯é—æ†¾çš„æ˜¯zookeeperå¹¶æ²¡æœ‰è®¾ç½®åœ¨å“ªä¸ªæ—¶é—´ç‚¹è¿è¡Œçš„è®¾ç½®ï¼Œæ‰€ä»¥æœ‰çš„æ—¶å€™æˆ‘ä»¬ä¼šç¦ç”¨è¿™ä¸ªè‡ªåŠ¨åˆ é™¤çš„åŠŸèƒ½ï¼Œè€Œåœ¨æœåŠ¡å™¨ä¸Šé…ç½®ä¸€ä¸ªcronï¼Œç„¶ååœ¨å‡Œæ™¨æ¥å¹²è¿™ä»¶äº‹ã€‚</p>
  </li>
  <li>
    <p>clientPort=2181
é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å®¢æˆ·ç«¯è¿æ¥zookeeperæœåŠ¡çš„ç«¯å£ã€‚è¿™æ˜¯ä¸€ä¸ªTCP portã€‚</p>
  </li>
  <li>
    <p>server.id=IP/Host : port1 : port2
idï¼šç”¨æ¥é…ç½®ZKé›†ç¾¤ä¸­çš„å„èŠ‚ç‚¹ï¼Œå¹¶å»ºè®®idçš„å€¼å’Œmyidä¿æŒä¸€è‡´ã€‚
IP/Host: æœåŠ¡å™¨çš„ IP æˆ–è€…æ˜¯ä¸ IP åœ°å€åšäº†æ˜ å°„çš„ä¸»æœºå
port1ï¼šLeaderå’ŒFolloweræˆ–Observeräº¤æ¢æ•°æ®ä½¿ç”¨
port2ï¼šç”¨äºLeaderé€‰ä¸¾
æ³¨æ„ï¼šå¦‚æœæ˜¯ä¼ªé›†ç¾¤çš„é…ç½®æ–¹å¼ï¼Œä¸åŒçš„ Zookeeper å®ä¾‹é€šä¿¡ç«¯å£å·ä¸èƒ½ä¸€æ ·ï¼Œæ‰€ä»¥è¦ç»™å®ƒä»¬åˆ†é…ä¸åŒçš„ç«¯å£å·ã€‚</p>
  </li>
  <li>
    <p>maxClientCnxns
å¯¹äºä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥æ•°é™åˆ¶ï¼Œé»˜è®¤æ˜¯60ï¼Œè¿™åœ¨å¤§éƒ¨åˆ†æ—¶å€™æ˜¯è¶³å¤Ÿäº†ã€‚
ä½†æ˜¯åœ¨æˆ‘ä»¬å®é™…ä½¿ç”¨ä¸­å‘ç°ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒç»å¸¸è¶…è¿‡è¿™ä¸ªæ•°ï¼Œç»è¿‡è°ƒæŸ¥å‘ç°æœ‰çš„å›¢é˜Ÿå°†å‡ åä¸ªåº”ç”¨å…¨éƒ¨éƒ¨ç½²åˆ°ä¸€å°æœºå™¨ä¸Šï¼Œä»¥æ–¹ä¾¿æµ‹è¯•ï¼Œäºæ˜¯è¿™ä¸ªæ•°å­—å°±è¶…è¿‡äº†</p>
  </li>
  <li>
    <p>minSessionTimeout, maxSessionTimeout
ä¸€èˆ¬ï¼Œå®¢æˆ·ç«¯è¿æ¥zookeeperçš„æ—¶å€™ï¼Œéƒ½ä¼šè®¾ç½®ä¸€ä¸ªsession timeoutï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´clientæ²¡æœ‰ä¸zookeeper serveræœ‰è”ç³»ï¼Œåˆ™è¿™ä¸ªsessionä¼šè¢«è®¾ç½®ä¸ºè¿‡æœŸ(å¦‚æœè¿™ä¸ªsessionä¸Šæœ‰ä¸´æ—¶èŠ‚ç‚¹ï¼Œåˆ™ä¼šè¢«å…¨éƒ¨åˆ é™¤ï¼Œè¿™å°±æ˜¯å®ç°é›†ç¾¤æ„ŸçŸ¥çš„åŸºç¡€ï¼Œåé¢çš„æ–‡ç« ä¼šä»‹ç»è¿™ä¸€ç‚¹)ã€‚
ä½†æ˜¯è¿™ä¸ªæ—¶é—´ä¸æ˜¯å®¢æˆ·ç«¯å¯ä»¥æ— é™åˆ¶è®¾ç½®çš„ï¼ŒæœåŠ¡å™¨å¯ä»¥è®¾ç½®è¿™ä¸¤ä¸ªå‚æ•°æ¥é™åˆ¶å®¢æˆ·ç«¯è®¾ç½®çš„èŒƒå›´ã€‚</p>
  </li>
</ul>

<p><strong>5ã€å¯åŠ¨å¹¶æµ‹è¯•(3å°æ‰§è¡Œä¸‹é¢å‘½ä»¤)</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zk1
<span class="nv">$ </span><span class="nb">cd</span> /zk/zookeeper-3.4.12/bin
<span class="nv">$ </span>./zkServer.sh start
<span class="nv">$ </span>ZooKeeper JMX enabled by default
Using config: /zk/zookeeper-3.4.12/bin/../conf/zoo.cfg
Mode: follower

zk2
<span class="nv">$ </span><span class="nb">cd</span> /zk/zookeeper-3.4.12/bin
<span class="nv">$ </span>./zkServer.sh start
<span class="nv">$ </span>ZooKeeper JMX enabled by default
Using config: /zk/zookeeper-3.4.12/bin/../conf/zoo.cfg
Mode: follower

zk3
zk1
<span class="nv">$ </span><span class="nb">cd</span> /zk/zookeeper-3.4.12/bin
<span class="nv">$ </span>./zkServer.sh start
<span class="nv">$ </span>ZooKeeper JMX enabled by default
Using config: /zk/zookeeper-3.4.12/bin/../conf/zoo.cfg
Mode: leader
</code></pre></div></div>

<p><strong>6ã€zkæ·»åŠ åˆ°å¼€æœºè‡ªå¯ä¸­</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ç¬¬ä¸€ç§æ–¹æ³•ï¼š
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"/zk/zookeeper-3.4.12/bin/zk.Server.sh start"</span> <span class="o">&gt;&gt;</span> /etc/rc.local

ç¬¬äºŒç§æ–¹æ³•<span class="o">(</span>æ¨èï¼Œç›®å½•ä½ç½®æ ¹æ®å®é™…ä½ç½®æ›´æ”¹<span class="o">)</span>ï¼š
<span class="nv">$ </span>vim /usr/lib/systemd/system/zookeeper.service
<span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>zookeeper.service
<span class="nv">After</span><span class="o">=</span>network.target

<span class="o">[</span>Service]
<span class="nv">Type</span><span class="o">=</span>forking
<span class="nv">Environment</span><span class="o">=</span><span class="nv">ZOO_LOG_DIR</span><span class="o">=</span>/zk/zookeeper-3.4.12/log
<span class="nv">ExecStart</span><span class="o">=</span>/zk/zookeeper-3.4.12/bin/zkServer.sh start
<span class="nv">ExecStop</span><span class="o">=</span>/zk/zookeeper-3.4.12/bin/zkServer.sh stop
<span class="nv">ExecReload</span><span class="o">=</span>/zk/zookeeper-3.4.12/bin/zkServer.sh restart
<span class="nv">Restart</span><span class="o">=</span>always

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target

<span class="nv">$ </span>systemctl daemon-reload  //é‡è½½é…ç½®
<span class="nv">$ </span>systemctl <span class="nb">enable </span>zookeeper //åŠ å…¥å¼€æœºè‡ªå¯
<span class="nv">$ </span>systemctl start zookeeper //å¯åŠ¨zookeeper

</code></pre></div></div>

<p><strong>7ã€åŸºæœ¬å‘½ä»¤</strong> <br />
ç™»å½•ZookeeperClientï¼š</p>
<pre><code class="language-log">$ ./zkCli.sh -server 192.168.95.86:2182
Connecting to 192.168.95.86:2182
2019-08-15 13:17:38,395 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.12-e5259e437540f349646870ea94dc2658c4e44b3b, built on 03/27/2018 03:55 GMT
2019-08-15 13:17:38,406 [myid:] - INFO  [main:Environment@100] - Client environment:host.name=node1
2019-08-15 13:17:38,407 [myid:] - INFO  [main:Environment@100] - Client environment:java.version=1.7.0_51
2019-08-15 13:17:38,443 [myid:] - INFO  [main:Environment@100] - Client environment:java.vendor=Oracle Corporation
2019-08-15 13:17:38,443 [myid:] - INFO  [main:Environment@100] - Client environment:java.home=/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.51-2.4.5.5.el7.x86_64/jre
2019-08-15 13:17:38,444 [myid:] - INFO  [main:Environment@100] - Client environment:java.class.path=/zk/zookeeper-3.4.12/bin/../build/classes:/zk/zookeeper-3.4.12/bin/../build/lib/*.jar:/zk/zookeeper-3.4.12/bin/../lib/slf4j-log4j12-1.7.25.jar:/zk/zookeeper-3.4.12/bin/../lib/slf4j-api-1.7.25.jar:/zk/zookeeper-3.4.12/bin/../lib/netty-3.10.6.Final.jar:/zk/zookeeper-3.4.12/bin/../lib/log4j-1.2.17.jar:/zk/zookeeper-3.4.12/bin/../lib/jline-0.9.94.jar:/zk/zookeeper-3.4.12/bin/../lib/audience-annotations-0.5.0.jar:/zk/zookeeper-3.4.12/bin/../zookeeper-3.4.12.jar:/zk/zookeeper-3.4.12/bin/../src/java/lib/*.jar:/zk/zookeeper-3.4.12/bin/../conf:
2019-08-15 13:17:38,445 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib
2019-08-15 13:17:38,445 [myid:] - INFO  [main:Environment@100] - Client environment:java.io.tmpdir=/tmp
2019-08-15 13:17:38,446 [myid:] - INFO  [main:Environment@100] - Client environment:java.compiler=&lt;NA&gt;
2019-08-15 13:17:38,446 [myid:] - INFO  [main:Environment@100] - Client environment:os.name=Linux
2019-08-15 13:17:38,447 [myid:] - INFO  [main:Environment@100] - Client environment:os.arch=amd64
2019-08-15 13:17:38,447 [myid:] - INFO  [main:Environment@100] - Client environment:os.version=3.10.0-123.el7.x86_64
2019-08-15 13:17:38,448 [myid:] - INFO  [main:Environment@100] - Client environment:user.name=root
2019-08-15 13:17:38,448 [myid:] - INFO  [main:Environment@100] - Client environment:user.home=/root
2019-08-15 13:17:38,449 [myid:] - INFO  [main:Environment@100] - Client environment:user.dir=/zk/zookeeper-3.4.12/bin
2019-08-15 13:17:38,453 [myid:] - INFO  [main:ZooKeeper@441] - Initiating client connection, connectString=192.168.95.86:2182 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@43e47e37
Welcome to ZooKeeper!
2019-08-15 13:17:38,619 [myid:] - INFO  [main-SendThread(192.168.95.86:2182):ClientCnxn$SendThread@1028] - Opening socket connection to server 192.168.95.86/192.168.95.86:2182. Will not attempt to authenticate using SASL (unknown error)
JLine support is enabled
2019-08-15 13:17:38,669 [myid:] - INFO  [main-SendThread(192.168.95.86:2182):ClientCnxn$SendThread@878] - Socket connection established to 192.168.95.86/192.168.95.86:2182, initiating session
2019-08-15 13:17:38,707 [myid:] - INFO  [main-SendThread(192.168.95.86:2182):ClientCnxn$SendThread@1302] - Session establishment complete on server 192.168.95.86/192.168.95.86:2182, sessionid = 0x2000ee31b6f0002, negotiated timeout = 30000

WATCHER::

WatchedEvent state:SyncConnected type:None path:null
[zk: 192.168.95.86:2182(CONNECTED) 0] help
ZooKeeper -server host:port cmd args
	connect host:port
	get path [watch]
	ls path [watch]
	set path data [version]
	rmr path
	delquota [-n|-b] path
	quit
	printwatches on|off
	create [-s] [-e] path data acl
	stat path [watch]
	close
	ls2 path [watch]
	history
	listquota path
	setAcl path acl
	getAcl path
	sync path
	redo cmdno
	addauth scheme auth
	delete path [version]
	setquota -n|-b val path
[zk: 192.168.95.86:2182(CONNECTED) 1]
</code></pre>

<p><strong>8ã€zookeeperå„ç±»æ—¥å¿—ç®€ä»‹</strong></p>

<p>zookeeperæœåŠ¡å™¨ä¼šäº§ç”Ÿä¸‰ç±»æ—¥å¿—ï¼šäº‹åŠ¡æ—¥å¿—ã€å¿«ç…§æ—¥å¿—å’Œlog4jæ—¥å¿—ã€‚</p>

<p>åœ¨zookeeperé»˜è®¤é…ç½®æ–‡ä»¶zoo.cfgï¼ˆå¯ä»¥ä¿®æ”¹æ–‡ä»¶åï¼‰ä¸­æœ‰ä¸€ä¸ªé…ç½®é¡¹dataDirï¼Œè¯¥é…ç½®é¡¹ç”¨äºé…ç½®zookeeperå¿«ç…§æ—¥å¿—å’Œäº‹åŠ¡æ—¥å¿—çš„å­˜å‚¨åœ°å€ã€‚</p>

<p>åœ¨å®˜æ–¹æä¾›çš„é»˜è®¤å‚è€ƒé…ç½®æ–‡ä»¶zoo_sample.cfgä¸­ï¼Œåªæœ‰dataDiré…ç½®é¡¹ã€‚å…¶å®åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿˜å¯ä»¥ä¸ºäº‹åŠ¡æ—¥å¿—ä¸“é—¨é…ç½®å­˜å‚¨åœ°å€ï¼Œé…ç½®é¡¹åç§°ä¸ºdataLogDirï¼Œåœ¨zoo_sample.cfgä¸­å¹¶æœªä½“ç°å‡ºæ¥ã€‚åœ¨æ²¡æœ‰dataLogDiré…ç½®é¡¹çš„æ—¶å€™ï¼Œzookeeperé»˜è®¤å°†äº‹åŠ¡æ—¥å¿—æ–‡ä»¶å’Œå¿«ç…§æ—¥å¿—æ–‡ä»¶éƒ½å­˜å‚¨åœ¨dataDirå¯¹åº”çš„ç›®å½•ä¸‹ã€‚</p>

<p>å»ºè®®å°†äº‹åŠ¡æ—¥å¿—ï¼ˆdataLogDirï¼‰ä¸å¿«ç…§æ—¥å¿—ï¼ˆdataLogï¼‰å•ç‹¬é…ç½®ï¼Œå› ä¸ºå½“zookeeperé›†ç¾¤è¿›è¡Œé¢‘ç¹çš„æ•°æ®è¯»å†™æ“ä½œæ˜¯ï¼Œä¼šäº§ç”Ÿå¤§é‡çš„äº‹åŠ¡æ—¥å¿—ä¿¡æ¯ï¼Œå°†ä¸¤ç±»æ—¥å¿—åˆ†å¼€å­˜å‚¨ä¼šæé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œè€Œä¸”ï¼Œå¯ä»¥å…è®¸å°†ä¸¤ç±»æ—¥å¿—å­˜åœ¨åœ¨ä¸åŒçš„å­˜å‚¨ä»‹è´¨ä¸Šï¼Œå‡å°‘ç£ç›˜å‹åŠ›ã€‚</p>

<p>dataDir:å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹version-2ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸­ä¿å­˜ç€æ•°æ®å¿«ç…§æ—¥å¿—æ–‡ä»¶ã€‚å¦‚ï¼šacceptedEpochã€currentEpoch
dataLogDirï¼šå­˜åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹version-2ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸­ä¿å­˜ç€äº‹ç‰©æ—¥å¿—æ–‡ä»¶ã€‚å¦‚ï¼šlog.*</p>

<p>log4jç”¨äºè®°å½•zookeeperé›†ç¾¤æœåŠ¡å™¨è¿è¡Œæ—¥å¿—ï¼Œè¯¥æ—¥å¿—çš„é…ç½®åœ°å€åœ¨conf/ç›®å½•ä¸‹çš„log4j.propertiesæ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªé…ç½®é¡¹ä¸ºâ€œzookeeper.log.dir=.â€ï¼Œè¡¨ç¤ºlog4jæ—¥å¿—æ–‡ä»¶åœ¨ä¸æ‰§è¡Œç¨‹åºzkServer.shåœ¨åŒä¸€ç›®å½•ä¸‹ã€‚å½“æ‰§è¡ŒzkServer.shæ—¶ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹ä¼šäº§ç”Ÿzookeeper.outæ—¥å¿—æ–‡ä»¶ã€‚</p>

<p><strong>9ã€ä¿®æ”¹ Zookeeper æ—¥å¿— zookeeper.out è¾“å‡ºè·¯å¾„</strong></p>

<p>å¦‚æœä¸åšä¿®æ”¹ï¼Œé»˜è®¤zookeeperçš„æ—¥å¿—è¾“å‡ºä¿¡æ¯éƒ½æ‰“å°åˆ°äº†zookeeper.outæ–‡ä»¶ä¸­ï¼Œè¿™æ ·è¾“å‡ºè·¯å¾„å’Œå¤§å°æ²¡æ³•æ§åˆ¶ï¼Œå› ä¸ºæ—¥å¿—æ–‡ä»¶æ²¡æœ‰è½®è½¬ã€‚æ‰€ä»¥éœ€è¦ä¿®æ”¹æ—¥å¿—è¾“å‡ºæ–¹å¼ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1ã€ä¿®æ”¹ ZOOKEEPER_HOME/bin/zkEnv.sh
å°†ï¼š
ZOO_LOG_DIR="."
æ”¹ä¸ºï¼š
ZOO_LOG_DIR="/home/{$user}/zookeeper/logs"

2ã€å†ä¿®æ”¹ä¸‹ZOO_LOG4J_PROPï¼Œè®©æ—¥å¿—ä¸æ˜¯è¾“å‡ºåˆ°zookeeper.outï¼Œè€Œæ˜¯å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶
å°†ï¼š
ZOO_LOG4J_PROP="INFO,CONSOLE"
æ”¹ä¸ºï¼š
ZOO_LOG4J_PROP="INFO,ROLLINGFILE"


3ã€ä¿®æ”¹: ZOOKEEPER_HOME/conf/log4j.properties


å¦‚æœæŒ‰æ—¥å¿—æ–‡ä»¶å¤§å°è½®è½¬ï¼Œåªéœ€æ‰§è¡Œä¸€æ­¥
zookeeper.root.logger=INFO,ROLLINGFILE


å¦‚æœæŒ‰ç…§å¤©è½®è½¬ï¼Œéœ€æ‰§è¡Œä»¥ä¸‹ä¸¤æ­¥
1ï¼‰ log4j.appender.ROLLINGFILE=org.apache.log4j.DailyRollingFileAppender
2ï¼‰ zkEnv.shï¼šæ³¨é‡Šæ‰# log4j.appender.ROLLINGFILE.MaxFileSize=10MB

4ã€ä¿®æ”¹ /zk/zookeeper-3.4.12/binzkServer.shï¼ˆå¯é€‰ï¼‰
å¯ä¸ä¿®æ”¹è¯¥æ–‡ä»¶ï¼Œåªæ˜¯zkçš„å¯åŠ¨è„šæœ¬é»˜è®¤ç”¨ nohup å¯åŠ¨ä¼šç”Ÿæˆä¸€ä¸ªzookeeper.outçš„ç©ºæ–‡ä»¶
è‹¥ä¿®æ”¹åˆ™æ‰§è¡Œä»¥ä¸‹ä¸¤æ­¥ï¼š
1ï¼‰ æ³¨é‡Šä»¥ä¸‹è¡Œ:
#_ZOO_DAEMON_OUT="$ZOO_LOG_DIR/zookeeper.out"

# nohup "$JAVA" "-Dzookeeper.log.dir.........
# -cp "$CLASSPATH" $JVMFLAGS $ZOOMAIN.........
æ·»åŠ è¯¥è¡Œ:
"$JAVA" "-Dzookeeper.log.dir=${ZOO_LOG_DIR}" "-Dzookeeper.root.logger=${ZOO_LOG4J_PROP}" -cp
</code></pre></div></div>

<h3 id="æŠ¥é”™">æŠ¥é”™</h3>
<h6 id="1å¯åŠ¨å¤±è´¥">1ã€å¯åŠ¨å¤±è´¥</h6>
<p>å¦‚æœæœ¬æœºæ²¡å®‰è£…javaï¼Œéœ€è¦å®‰è£…java.å¦‚æœå®‰è£…äº†javaï¼Œéœ€è¦åœ¨bin/zkServer.shä¸­æŒ‡å®šjavaè·¯å¾„</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/local/java
</code></pre></div></div>
:ET
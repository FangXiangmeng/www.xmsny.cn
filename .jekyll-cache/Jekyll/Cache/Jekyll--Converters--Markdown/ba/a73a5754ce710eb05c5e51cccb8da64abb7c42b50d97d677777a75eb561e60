I"ˆ9<h2 id="shellæ•´ç†">shellæ•´ç†</h2>
<p><strong>1.åˆ é™¤k8sæ‰€æœ‰devopså¼€å¤´çš„namespace</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> for i in `kubectl get ns --all-namespaces  |awk '{print $1}'|grep  ^devops`;do kubectl delete ns $i ;done
</code></pre></div></div>

<p><strong>2.æ‰“åŒ…ä¸»æœºæ‰€æœ‰dockeré•œåƒ</strong>
<strong>v1åªèƒ½æ‰“åŒ…é•œåƒåç§°å¸¦/çš„</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nv">i</span><span class="o">=</span>0
<span class="k">while </span><span class="nb">true</span><span class="p">;</span>
<span class="k">do
   </span><span class="nb">let </span>i++
   <span class="nv">ImageNameall</span><span class="o">=</span><span class="sb">`</span>docker images | <span class="nb">sort</span> | <span class="nb">grep</span> <span class="nt">-v</span> ^R | <span class="nb">awk</span> <span class="s1">'{print $1}'</span>| xargs <span class="nb">echo</span><span class="sb">`</span>
   <span class="nv">ImageName</span><span class="o">=</span><span class="sb">`</span>docker images | <span class="nb">sort</span> | <span class="nb">awk</span>  <span class="s1">'{print $1}'</span>| <span class="nb">awk</span> <span class="nt">-F</span> / <span class="s1">'{print $2}'</span>| <span class="nb">grep</span> <span class="nt">-v</span> ^R | xargs <span class="nb">echo</span><span class="sb">`</span>
   <span class="nv">ImageTag</span><span class="o">=</span><span class="sb">`</span>docker images | <span class="nb">sort</span> | <span class="nb">awk</span> <span class="s1">'{print $2}'</span>| <span class="nb">grep</span> <span class="nt">-v</span> ^T | xargs <span class="nb">echo</span><span class="sb">`</span>
   <span class="nv">Imageamount</span><span class="o">=</span><span class="sb">`</span>docker images |grep <span class="nt">-v</span> ^R|wc <span class="nt">-l</span><span class="sb">`</span>
   <span class="k">if</span> <span class="o">[</span> <span class="nv">$i</span> <span class="nt">-le</span> <span class="nv">$Imageamount</span> <span class="o">]</span><span class="p">;</span><span class="k">then
      </span>docker save <span class="nt">-o</span>   <span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ImageName</span>|cut <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f</span> <span class="nv">$i</span><span class="sb">`</span>.tar.gz  <span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ImageNameall</span>|cut <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f</span> <span class="nv">$i</span><span class="sb">`</span>:<span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ImageTag</span>|cut <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f</span> <span class="nv">$i</span><span class="sb">`</span>
  <span class="k">else
      </span><span class="nb">break
   </span><span class="k">fi
done</span>
</code></pre></div></div>

<p><strong>v2èƒ½æ‰“åŒ…é•œåƒåç§°æ˜¯centoså’Œcoredns/latestè¿™ç§å‘½åé•œåƒ</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nv">i</span><span class="o">=</span>0
<span class="k">while </span><span class="nb">true</span><span class="p">;</span>
<span class="k">do
   </span><span class="nb">let </span>i++
   <span class="nv">ImageNameall</span><span class="o">=</span><span class="sb">`</span>docker images | <span class="nb">sort</span> | <span class="nb">grep</span> <span class="nt">-v</span> ^R | <span class="nb">awk</span> <span class="s1">'{print $1}'</span>| xargs <span class="nb">echo</span>|cut <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f</span><span class="nv">$i</span><span class="sb">`</span>
   <span class="nv">ImageTag</span><span class="o">=</span><span class="sb">`</span>docker images | <span class="nb">sort</span> | <span class="nb">awk</span> <span class="s1">'{print $2}'</span>| <span class="nb">grep</span> <span class="nt">-v</span> ^T | xargs <span class="nb">echo</span><span class="sb">`</span>
   <span class="nv">Imageamount</span><span class="o">=</span><span class="sb">`</span>docker images |grep <span class="nt">-v</span> ^R|wc <span class="nt">-l</span><span class="sb">`</span>
   <span class="k">if</span> <span class="o">!</span> <span class="o">[[</span> <span class="nv">$ImageNameall</span> <span class="o">=</span>~ <span class="s2">"/"</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="nv">$i</span> <span class="nt">-le</span> <span class="nv">$Imageamount</span> <span class="o">]</span><span class="p">;</span><span class="k">then
      </span>docker save <span class="nt">-o</span>  <span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ImageNameall</span>|cut <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f</span> <span class="nv">$i</span><span class="sb">`</span>.tar.gz  <span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ImageNameall</span>|cut <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f</span> <span class="nv">$i</span><span class="sb">`</span>:<span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ImageTag</span>|cut <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f</span> <span class="nv">$i</span><span class="sb">`</span>
   <span class="k">elif</span> <span class="o">[[</span> <span class="nv">$ImageNameall</span> <span class="o">=</span>~ <span class="s2">"/"</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="nv">$i</span> <span class="nt">-le</span> <span class="nv">$Imageamount</span> <span class="o">]</span><span class="p">;</span><span class="k">then
      </span>docker save <span class="nt">-o</span>  <span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ImageNameall</span>|awk <span class="nt">-F</span> / <span class="s1">'{print $2}'</span>|cut <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f</span> <span class="nv">$i</span><span class="sb">`</span>.tar.gz  <span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ImageNameall</span>|cut <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f</span> <span class="nv">$i</span><span class="sb">`</span>:<span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ImageTag</span>|cut <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f</span> <span class="nv">$i</span><span class="sb">`</span>
   <span class="k">else
      </span><span class="nb">break
   </span><span class="k">fi
done</span>

</code></pre></div></div>

<p><strong>3.åˆ é™¤k8sé›†ç¾¤ä¸­æ‰€æœ‰podçŠ¶æ€æ˜¯Terminatingçš„</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nv">delete</span><span class="o">=</span><span class="sb">`</span>kubectl get pod <span class="nt">--all-namespaces</span>  <span class="nt">-o</span> wide |grep  Terminating |awk <span class="s1">'{print $2}'</span><span class="sb">`</span>
<span class="nv">delete1</span><span class="o">=</span><span class="sb">`</span>kubectl get pod <span class="nt">--all-namespaces</span>  <span class="nt">-o</span> wide |grep  Terminating |awk <span class="s1">'{print $1}'</span><span class="sb">`</span>
<span class="nv">i</span><span class="o">=</span>0
<span class="k">for </span>a <span class="k">in</span> <span class="nv">$delete</span><span class="p">;</span><span class="k">do
  </span><span class="nb">let </span>i++
  kubectl delete pod <span class="nv">$a</span> <span class="nt">-n</span> <span class="sb">`</span><span class="nb">echo</span> <span class="nv">$delete1</span>|cut <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f</span> <span class="nv">$i</span><span class="sb">`</span> <span class="nt">--grace-period</span><span class="o">=</span>0 <span class="nt">--force</span>
<span class="k">done</span>
</code></pre></div></div>

<p><strong>4.æ£€æµ‹k8s Master Nodeä¸Šé¢ç»„ä»¶çŠ¶æ€</strong></p>
<blockquote>
  <p>Masteréœ€è¦æ›´æ–°
```
#!/bin/bash
 Service_status_master=â€kube-apiserver kube-controller-manager kube-scheduler flanneld dockerâ€
   for status in ${Service_status_master};do
       service_status=<code class="highlighter-rouge">systemctl status ${status} |grep active |awk '{print $3}'|cut -d '(' -f2|cut -d ')' -f1</code>
       if [ â€œ${service_status}â€ == â€œrunningâ€ ];then
           echo -e â€œ\033[32;1m ${status} status running \033[0mâ€
           sleep 1
       else
           echo -e â€œ\033[32;1m ${status} is dead, be being restart  \033[0mâ€
           systemctl restart ${status}
           sleep 3
           service_status=<code class="highlighter-rouge">systemctl status ${status} |grep active |awk '{print $3}'|cut -d '(' -f2|cut -d ')' -f1</code>
           if [[ â€œ${service_status}â€ == â€œrunningâ€ ]];then
              echo -e â€œ\033[32;1m ${status} restart scuueed \033[0mâ€
           else
              echo -e â€œ\033[32;1m ${status} restart failure,please check the log \033[0mâ€
           fi
       fi
   done</p>
</blockquote>

<p>Service_status_node=â€kubelet kube-proxy docker flanneldâ€
  for status in ${Service_status_node};do
       service_status=<code class="highlighter-rouge">systemctl status ${status} |grep active |awk '{print $3}'|cut -d '(' -f2|cut -d ')' -f1</code>
       if [ â€œ${service_status}â€ == â€œrunningâ€ ];then
           echo -e â€œ\033[32;1m ${status} status running \033[0mâ€
           sleep 1
       else
           echo -e â€œ\033[32;1m ${status} is dead, be being restart  \033[0mâ€
           systemctl restart ${status}
           sleep 3
           service_status=<code class="highlighter-rouge">systemctl status ${status} |grep active |awk '{print $3}'|cut -d '(' -f2|cut -d ')' -f1</code>
           if [[ â€œ${service_status}â€ == â€œrunningâ€ ]];then
              echo -e â€œ\033[32;1m ${status} restart scuueed \033[0mâ€
           else
              echo -e â€œ\033[32;1m ${status} restart failure,please check the log \033[0mâ€
           fi
       fi
   done</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**5.expectä½¿ç”¨**
</code></pre></div></div>
<p>#!/usr/bin/expect
#set timeout 3600
set host [lindex $argv 0]
set username [lindex $argv 1]
set password [lindex $argv 2]
set src_file [lindex $argv 3]
set dest_file [lindex $argv 4]
#spawn scp $src_file $username@$host:$dest_file
spawn scp $src_file  $username@$host:$dest_file
expect {
 â€œ(yes/no)?â€ {
   send â€œyes\nâ€
   expect â€œ<em>assword:â€ { send â€œ$password\nâ€}
  }
  â€œ</em>assword:â€ {
   send â€œ$password\nâ€
  }
}
#expect â€œ100%â€
expect eof</p>

<p>#!/bin/bash
##env
src_dir=â€/root/.ssh/id_rsa.pubâ€
dest_dir=â€/root/.ssh/authorized_keysâ€
username=â€rootâ€
host=â€192.168.95.85 192.168.95.87â€
password=â€ultra#2018#85 ultra#2018#87â€
i=0
for hostip in $host
do
  echo $hostip
  let i++
   ./expect.exp $hostip $username <code class="highlighter-rouge">echo ${password} | cut -d " " -f $i</code>  $src_dir $dest_dir
###cut -d â€œ â€œ -f $i:   -dï¼šè¡¨ç¤ºä»¥ä»€ä¹ˆåšåˆ†å‰²  -f è¡¨ç¤ºéœ€è¦é€‰å–çš„å­—æ®µï¼Œæ ¹æ®-dåˆ‡åˆ†çš„å­—æ®µé›†é€‰å–ï¼Œä¸‹æ ‡ä»1å¼€å§‹ï¼Œ    i++è¡¨ç¤ºï¼Œä»1å¼€å§‹ä¸€ç›´é€‰å–å­—æ®µã€‚
done</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**6.loadå½“å‰ç›®å½•ä¸‹é¢çš„æ‰€æœ‰Imgaes**
</code></pre></div></div>
<p>for images in <code class="highlighter-rouge">ll |awk '{print $9}'</code> ;do docker load -i  $images ;done</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**7.åˆ é™¤æ‰€æœ‰dockeré•œåƒ**
</code></pre></div></div>
<p>docker rmi -f $(docker images -qa)</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**8.vimä¸­å¤šè¡Œæ›¿æ¢**
</code></pre></div></div>
<p>:1000,1120s/192.168.0.111/192.168.0.112/g</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**9.éå†æ•°ç»„** 
</code></pre></div></div>
<p>//å®šä¹‰æ•°ç»„
$ export variable=(arg1 arg2 arg3 â€¦.)
//è·å–ä¸‹æ ‡ä¸º0çš„å…ƒç´ 
$ echo ${variable[0]}
arg1
//è·å–æ‰€æœ‰ä¸‹æ ‡
${#variable[@]}æˆ–è€…${#variable[*]}
//é‚£ä¹ˆå¦‚ä½•ç”¨foréå†å‘¢ï¼Ÿä¸€å…±æœ‰ä¸¤ç§æ–¹å¼
for i in ${variable[@]}; do echo $i;done
for i in $(seq 0 ${#variable[@]}); do echo $i;done</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**10.åˆ é™¤1å¤©å‰çš„æ–‡ä»¶**
</code></pre></div></div>
<p>-amin nã€€ã€€æŸ¥æ‰¾ç³»ç»Ÿä¸­æœ€åNåˆ†é’Ÿè®¿é—®çš„æ–‡ä»¶
-atime nã€€ã€€æŸ¥æ‰¾ç³»ç»Ÿä¸­æœ€ån<em>24å°æ—¶è®¿é—®çš„æ–‡ä»¶
-cmin nã€€ã€€æŸ¥æ‰¾ç³»ç»Ÿä¸­æœ€åNåˆ†é’Ÿè¢«æ”¹å˜æ–‡ä»¶çŠ¶æ€çš„æ–‡ä»¶
-ctime nã€€ã€€æŸ¥æ‰¾ç³»ç»Ÿä¸­æœ€ån</em>24å°æ—¶è¢«æ”¹å˜æ–‡ä»¶çŠ¶æ€çš„æ–‡ä»¶
-mmin nã€€ã€€æŸ¥æ‰¾ç³»ç»Ÿä¸­æœ€åNåˆ†é’Ÿè¢«æ”¹å˜æ–‡ä»¶æ•°æ®çš„æ–‡ä»¶
-mtime nã€€ã€€æŸ¥æ‰¾ç³»ç»Ÿä¸­æœ€ån*24å°æ—¶è¢«æ”¹å˜æ–‡ä»¶æ•°æ®çš„æ–‡ä»¶</p>

<p>$ find ./ -mtime +1 -exec rm -rf {} \;  /åˆ é™¤1å¤©å‰çš„ä»¶
$ find ./ -type f -mmin +1 -exec ls -l {} \;  /åˆ é™¤1åˆ†é’Ÿå‰çš„æ–‡ä»¶
$ find ./ -size +10M |xargs rm -f  /åˆ é™¤å¤§äº10mçš„æ–‡ä»¶</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**11.æ‰¹é‡pushç§æœ‰ä»“åº“é•œåƒåˆ°Harbor**
</code></pre></div></div>
<p>#!/bin/bash
imagesname=($(docker images |grep ^192.168 |awk â€˜{print $1}â€™))
tag=($(docker images |grep ^192.168 |awk â€˜{print $2}â€™))
i=0
while true
do
  docker push ${imagesname[$i]}:${tag[$i]}
  let i++
done</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**12.æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæ—¶é—´**
</code></pre></div></div>
<p>openssl x509 -in /etc/kubernetes/ssl/ca.pem -noout -text |grep â€˜ Not â€˜</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**13ã€å»æ‰winè½¬linuxä¸­å¤šä½™å¾—^m**
</code></pre></div></div>
<p>$ sed -i â€˜s/\r//gâ€™</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
**14ã€cpæ–‡ä»¶å¤¹ä¸‹å½“å¤©æ–‡ä»¶**
</code></pre></div></div>
<p>#!/bin/bash
targetdir=/data
sourcedir=(/Ultrapower/webhome/meopen/style/rollInfoImages/ /Ultrapower/webhome/meopen_slave/style/rollInfoImages/)</p>

<p>for file in ${sourcedir[@]};
do
    find ${file} -type f -mtime -1 -name â€œ*â€ | xargs -i cp -rf  {}  ${targetdir}
done
```</p>
:ET